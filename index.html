<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Invitación Bowling – Generador (Canvas)</title>
<style>
  :root{
    --maxw: 520px;
    --ui-bg: #0b0b12;
  }
  html,body{margin:0;height:100%;background:var(--ui-bg);color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .wrap{max-width:var(--maxw);margin:0 auto;padding:14px 14px 110px}
  .card{width:100%;position:relative}
  canvas{width:100%;height:auto;border-radius:16px;box-shadow:0 12px 40px rgba(0,0,0,.5);background:#000}
  .panel{margin-top:12px;display:grid;gap:10px}
  .panel label{font-size:14px;opacity:.9}
  .panel input{
    width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.18);
    background:#1b1b25;color:#fff;font-weight:600;outline:none;
  }
  .panel small{opacity:.65}
  .toolbar{position:fixed;left:0;right:0;bottom:0;background:rgba(12,12,18,.88);backdrop-filter:blur(6px);
    border-top:1px solid rgba(255,255,255,.08);padding:10px 12px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
  button{appearance:none;border:none;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer;background:#7c3aed;color:#fff;
    box-shadow:0 6px 20px rgba(124,58,237,.35)}
  button.secondary{background:#2a2a35;box-shadow:none}
  button:active{transform:translateY(1px)}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <canvas id="cv" width="1080" height="2800"></canvas>
    </div>

    <div class="panel">
      <div>
        <label for="soy">Soy</label>
        <input id="soy" placeholder="Tu nombre"/>
      </div>
      <div>
        <label for="nombre">Nombre del invitado</label>
        <input id="nombre" placeholder="Nombre del invitado"/>
      </div>
      <div>
        <label for="dia">El día</label>
        <input id="dia" placeholder="DD/MM/AAAA"/>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div>
          <label for="horaDe">Hora – De las</label>
          <input id="horaDe" placeholder="HH:MM"/>
        </div>
        <div>
          <label for="horaA">Hora – A las</label>
          <input id="horaA" placeholder="HH:MM"/>
        </div>
      </div>
      <div>
        <label for="confirma">Confirma al</label>
        <input id="confirma" placeholder="Teléfono o Email"/>
      </div>
      <small>Completa los campos. La previsualización se actualiza arriba y puedes descargar PNG o PDF.</small>
    </div>
  </div>

  <div class="toolbar">
    <button id="btnPng">Descargar PNG</button>
    <button id="btnPdf" class="secondary">Descargar PDF</button>
    <button id="btnShare" class="secondary">Compartir</button>
  </div>

<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script>
const W = 1080, H = 2800;
const cfg = {
  bgUrl: 'bg.png',
  boxes: {
    soy:      {x: 0.10, y: 0.437, w: 0.80, h: 0.047},
    nombre:   {x: 0.14, y: 0.606, w: 0.72, h: 0.049},
    dia:      {x: 0.14, y: 0.674, w: 0.72, h: 0.048},
    hora:     {x: 0.14, y: 0.740, w: 0.72, h: 0.049},
    confirma: {x: 0.14, y: 0.811, w: 0.72, h: 0.050},
  },
  horaDe: { left: 0.39, width: 0.20 },
  horaA:  { right: 0.19, width: 0.20 },
  maxFont: 70,
  minFont: 32,
  font: 'bold {px}px Arial, Helvetica, sans-serif',
  color: '#000000',
  placeholderColor: '#777777'
};

const cv = document.getElementById('cv');
const ctx = cv.getContext('2d');

const bg = new Image();
bg.onload = ()=> draw();
bg.src = cfg.bgUrl;

function pxBox(b){ return { x: Math.round(b.x * W), y: Math.round(b.y * H), w: Math.round(b.w * W), h: Math.round(b.h * H) }; }

function fitText(text, maxWidth, maxPx, minPx){
  let size = maxPx;
  while(size > minPx){
    ctx.font = cfg.font.replace('{px}', size);
    const w = ctx.measureText(text).width;
    if (w <= maxWidth * 0.92) break;
    size -= 1;
  }
  return size;
}

function drawBoxText(box, text, placeholder){
  const b = pxBox(box);
  const t = (text || '').trim();
  const show = t.length ? t : (placeholder || '');
  const color = t.length ? cfg.color : cfg.placeholderColor;

  const fontSize = fitText(show, b.w, cfg.maxFont, cfg.minFont);
  ctx.font = cfg.font.replace('{px}', fontSize);
  ctx.fillStyle = color;
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(show, b.x + b.w/2, b.y + b.h/2);
}

function draw(){
  ctx.clearRect(0,0,W,H);
  ctx.drawImage(bg, 0, 0, W, H);

  const val = id => document.getElementById(id).value;

  drawBoxText(cfg.boxes.soy, val('soy'), 'Escribe tu nombre');
  drawBoxText(cfg.boxes.nombre, val('nombre'), 'Nombre del invitado');
  drawBoxText(cfg.boxes.dia, val('dia'), 'DD/MM/AAAA');

  const hb = pxBox(cfg.boxes.hora);
  // De las
  const deW = Math.round(cfg.horaDe.width * hb.w);
  const deX = Math.round(hb.x + cfg.horaDe.left * hb.w + deW/2);
  const hourFontMax = Math.round(cfg.maxFont * 0.82);
  const hourMin = Math.round(cfg.minFont * 0.82);
  const deText = (val('horaDe') || '').trim() || 'HH:MM';
  ctx.font = cfg.font.replace('{px}', fitText(deText, deW, hourFontMax, hourMin));
  ctx.fillStyle = (val('horaDe')||'').trim() ? cfg.color : cfg.placeholderColor;
  ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
  ctx.fillText(deText, deX, hb.y + hb.h/2);

  // A las
  const aW = Math.round(cfg.horaA.width * hb.w);
  const aX = Math.round(hb.x + hb.w - (cfg.horaA.right * hb.w) - aW/2);
  const aText = (val('horaA') || '').trim() || 'HH:MM';
  ctx.font = cfg.font.replace('{px}', fitText(aText, aW, hourFontMax, hourMin));
  ctx.fillStyle = (val('horaA')||'').trim() ? cfg.color : cfg.placeholderColor;
  ctx.fillText(aText, aX, hb.y + hb.h/2);

  drawBoxText(cfg.boxes.confirma, val('confirma'), 'Teléfono o Email');
}

['soy','nombre','dia','horaDe','horaA','confirma'].forEach(id=>{
  const el = document.getElementById(id);
  el.addEventListener('input', draw);
  el.addEventListener('change', draw);
});

document.getElementById('btnPng').addEventListener('click', ()=>{
  const a = document.createElement('a');
  a.download = `invitacion-bowling-${Date.now()}.png`;
  a.href = cv.toDataURL('image/png');
  a.click();
});

document.getElementById('btnPdf').addEventListener('click', ()=>{
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({orientation:'portrait', unit:'px', format:[W, H]});
  doc.addImage(cv.toDataURL('image/jpeg', 0.98), 'JPEG', 0, 0, W, H);
  doc.save(`invitacion-bowling-${Date.now()}.pdf`);
});

document.getElementById('btnShare').addEventListener('click', async ()=>{
  try{
    const blob = await (await fetch(cv.toDataURL('image/png'))).blob();
    const file = new File([blob], `invitacion-bowling.png`, { type:'image/png' });
    if(navigator.canShare && navigator.canShare({ files:[file] })){
      await navigator.share({ files:[file], title:'Invitación Bowling', text:'Te comparto la invitación ✨' });
    }else{
      alert('Tu navegador no soporta compartir archivos. Usa “Descargar PNG”.');
    }
  }catch(e){
    alert('No se pudo abrir la hoja de compartir. Usa “Descargar PNG”.');
  }
});

draw();
</script>
</body>
</html>
